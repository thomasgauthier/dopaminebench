The user is asking for the content of a specific section, "5.6 Syntax Highlighting", which appears to be a section within a Markdown document. Based on the provided context, this section is likely part of the `anomalyco/opentui` project's documentation, specifically a wiki page or a README file. However, the provided codebase context does not contain a file with the exact section "5.6 Syntax Highlighting". The closest relevant information is found in the wiki page titled "Code Components"  which discusses syntax highlighting in detail.

Since I cannot directly access a section named "5.6 Syntax Highlighting" from the provided context, I will provide the content related to syntax highlighting from the "Code Components" wiki page, as it is the most relevant information available.

## Syntax Highlighting in OpenTUI

The OpenTUI project provides syntax-highlighted display of source code, diffs, and line-numbered code blocks through its code components. This functionality is deeply integrated with the Tree-sitter parsing system, offering rich syntax highlighting for various languages, markdown concealment, and specialized rendering for code diffs. 

### `CodeRenderable`

The `CodeRenderable` component is responsible for displaying syntax-highlighted code. It supports multiple languages, markdown concealment, and streaming updates. 

#### Core Properties 

The `CodeRenderable` component has several core properties that control its behavior:

*   `content`: The source code text to be displayed. 
*   `filetype`: Specifies the language for highlighting (e.g., "typescript", "markdown"). 
*   `syntaxStyle`: A required property that defines the token color mappings. 
*   `conceal`: A boolean flag (default `true`) to hide markup characters like markdown `**`. 
*   `drawUnstyledText`: If `true` (default), plain text is shown before highlighting completes. 
*   `streaming`: A boolean flag (default `false`) to optimize for incremental content updates. 
*   `treeSitterClient`: The parser for syntax highlighting, typically a global instance. 

These properties are initialized in the `CodeRenderable` constructor  and can be updated via setters. For example, changing `content`  or `filetype`  marks the highlights as dirty, triggering a re-highlighting process.

#### Highlighting Lifecycle 

The highlighting process is asynchronous and handles stale updates to ensure efficiency. When the `content` or `filetype` of a `CodeRenderable` changes, a `_highlightSnapshotId` is incremented, and a `_highlightsDirty` flag is set to `true`.  If `drawUnstyledText` is `true`, the text buffer is updated immediately with plain text.  An asynchronous highlight operation is then initiated. If the content changes again during an ongoing highlight, the `_highlightSnapshotId` is incremented, and the previous highlight result is discarded if its snapshot ID does not match the current one. 

#### Content Update Handling 

The `CodeRenderable` component batches concurrent updates to avoid redundant highlighting. A `_highlightSnapshotId` is incremented on each content or filetype change to invalidate in-flight highlights, and a `_highlightsDirty` flag tracks whether re-highlighting is needed.  When a highlight completes, it checks the snapshot ID before applying the results to prevent stale data from being rendered. 

#### Streaming Mode 

For incremental content updates, such as those from an LLM, the `streaming` property can be set to `true`.  In this mode, if `drawUnstyledText` is `false`, the content setter skips immediate text buffer updates, preventing thrashing during rapid content changes. The text buffer only updates after the highlight completes. 

#### Concealment 

When `conceal` is `true`, markdown markup characters (e.g., `**`, `*`, `[]()`) are hidden from display.  This is applied during the `treeSitterToTextChunks` conversion process.  Toggling the `conceal` state triggers a re-highlighting.  This functionality is also tested in `DiffRenderable` to ensure no endless loops occur when concealing markdown formatting. 

### Syntax Highlighting System 

#### TreeSitterClient Integration 

The `CodeRenderable` component uses `TreeSitterClient` to perform asynchronous syntax parsing.  The `TreeSitterClient` interacts with a Tree-sitter WASM worker to get `SimpleHighlight` results, which are then used with `SyntaxStyle` to apply colors and concealment via `treeSitterToTextChunks()`, ultimately producing `StyledText` for the `TextBuffer`.  The `TreeSitterClient` also handles injections for highlighting inline code and code blocks within markdown.  

#### Highlight Result Format 

Tree-sitter returns an array of `SimpleHighlight` tuples, where each tuple contains the start byte offset, end byte offset, scope name (e.g., "keyword", "string"), and optional metadata for concealment or injection.  These highlights are sorted by their start position and then used to split the text into chunks, apply colors based on `SyntaxStyle`, and handle concealment. 

### Examples 

#### Basic Code Display 

A `CodeRenderable` can be initialized with `content`, `filetype`, and a `syntaxStyle`. The `drawUnstyledText` property can be set to `true` to show text immediately while highlighting is in progress. 

```typescript
const syntaxStyle = SyntaxStyle.fromStyles({
  keyword: { fg: parseColor("#FF7B72"), bold: true },
  string: { fg: parseColor("#A5D6FF") },
  default: { fg: parseColor("#E6EDF3") },
})

const code = new CodeRenderable(ctx, {
  content: 'const message = "Hello";',
  filetype: "javascript",
  syntaxStyle,
  drawUnstyledText: true,
})
```


#### Streaming Code Updates 

For streaming content, the `streaming` property is set to `true`, and `drawUnstyledText` can be `false` to wait for highlights before rendering. 

```typescript
const code = new CodeRenderable(ctx, {
  content: "",
  filetype: "markdown",
  syntaxStyle,
  streaming: true,
  drawUnstyledText: false,
})

// Incremental updates (e.g., from LLM)
for (const chunk of streamedChunks) {
  code.content += chunk
}
```


## Notes

The prompt specifically asked for "5.6 Syntax Highlighting". Since no direct match for this section was found in the provided codebase context, the answer focuses on the "Code Components" wiki page  which extensively covers syntax highlighting within the `anomalyco/opentui` project. This wiki page is the most relevant source of information regarding syntax highlighting.

Wiki pages you might want to explore:
- [Code Components (anomalyco/opentui)](/wiki/anomalyco/opentui#4.4)

View this search on DeepWiki: https://deepwiki.com/search/provide-the-full-markdown-cont_6ceec456-40a7-4f94-8fc4-c92606a308ad
